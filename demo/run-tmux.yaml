session_name: 'hydra-demo'

setup:
  root:
    './demo'
  cmds:
    - '[ -d ./devnet ] || ./prepare-devnet.sh && ./seed-devnet.sh $(which cardano-cli)'

windows:
  cardano-node:
    - cmd:
        [ 'cardano-node', 'run'
        , '--config', 'devnet/cardano-node.json'
        , '--topology', 'devnet/topology.json'
        , '--database-path', 'devnet/db'
        , '--socket-path', 'devnet/ipc/node.socket'
        , '--shelley-operational-certificate', 'devnet/opcert.cert'
        , '--shelley-kes-key', 'devnet/kes.skey'
        , '--shelley-vrf-key', 'devnet/vrf.skey'
        ]
      await_cmd: 'sleep 2'
  hydra-nodes:
    - cmd:
        [ 'hydra-node'
        , '--node-id', '1'
        , '--port', '5001'
        , '--api-port', '4001'
        , '--monitoring-port', '6001'
        , '--hydra-signing-key', 'alice.sk'
        , '--cardano-signing-key', 'devnet/credentials/alice.sk'
        , '--ledger-genesis', 'devnet/genesis-shelley.json'
        , '--ledger-protocol-parameters', 'devnet/protocol-parameters.json'
        , '--network-id', '42'
        , '--node-socket', 'devnet/ipc/node.socket'
        , '--peer', 'localhost:5002'
        , '--peer', 'localhost:5003'
        , '--hydra-verification-key', 'bob.vk'
        , '--hydra-verification-key', 'carol.vk'
        , '--cardano-verification-key', './devnet/credentials/bob.vk'
        , '--cardano-verification-key', './devnet/credentials/carol.vk'
        ]
      await_cmd: 'sleep 1'
    - cmd:
        [ 'hydra-node'
        , '--node-id', '2'
        , '--port', '5002'
        , '--api-port', '4002'
        , '--monitoring-port', '6002'
        , '--hydra-signing-key', 'bob.sk'
        , '--cardano-signing-key', 'devnet/credentials/bob.sk'
        , '--ledger-genesis', 'devnet/genesis-shelley.json'
        , '--ledger-protocol-parameters', 'devnet/protocol-parameters.json'
        , '--network-id', '42'
        , '--node-socket', 'devnet/ipc/node.socket'
        , '--hydra-verification-key', './alice.vk'
        , '--hydra-verification-key', './carol.vk'
        , '--cardano-verification-key', './devnet/credentials/alice.vk'
        , '--cardano-verification-key', './devnet/credentials/carol.vk'
        ]
      await_cmd: 'sleep 1'
    - cmd:
        [ 'hydra-node'
        , '--node-id', '2'
        , '--port', '5003'
        , '--api-port', '4003'
        , '--monitoring-port', '6003'
        , '--hydra-signing-key', 'carol.sk'
        , '--cardano-signing-key', 'devnet/credentials/carol.sk'
        , '--ledger-genesis', 'devnet/genesis-shelley.json'
        , '--ledger-protocol-parameters', 'devnet/protocol-parameters.json'
        , '--network-id', '42'
        , '--node-socket', 'devnet/ipc/node.socket'
        , '--hydra-verification-key', './alice.vk'
        , '--hydra-verification-key', './bob.vk'
        , '--cardano-verification-key', './devnet/credentials/alice.vk'
        , '--cardano-verification-key', './devnet/credentials/bob.vk'
        ]
      await_cmd: 'sleep 1'
  hydra-tuis:
    - cmd:
        [ 'hydra-tui'
        , '--connect', '0.0.0.0:4001'
        , '--cardano-signing-key', 'devnet/credentials/alice.sk'
        , '--network-id', '42'
        , '--node-socket', 'devnet/ipc/node.socket'
        ]
    - cmd:
        [ 'hydra-tui'
        , '--connect', '0.0.0.0:4002'
        , '--cardano-signing-key', 'devnet/credentials/bob.sk'
        , '--network-id', '42'
        , '--node-socket', 'devnet/ipc/node.socket'
        ]
    - cmd:
        [ 'hydra-tui'
        , '--connect', '0.0.0.0:4003'
        , '--cardano-signing-key', 'devnet/credentials/carol.sk'
        , '--network-id', '42'
        , '--node-socket', 'devnet/ipc/node.socket'
        ]
